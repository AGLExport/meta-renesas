From 3f30940b76b12b7fe3d4314d93ee359c1a3e8884 Mon Sep 17 00:00:00 2001
From: Yusuke Goda <yusuke.goda.sx@renesas.com>
Date: Tue, 2 Apr 2013 20:35:17 +0900
Subject: [PATCH 09/11] Local: ARM: shmobile: r8a7778: add hspi platform
 support

Signed-off-by: Yusuke Goda <yusuke.goda.sx@renesas.com>
---
 arch/arm/mach-shmobile/board-bockw.c | 24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)

diff --git a/arch/arm/mach-shmobile/board-bockw.c b/arch/arm/mach-shmobile/board-bockw.c
index b5fadc5..c34f4ce 100644
--- a/arch/arm/mach-shmobile/board-bockw.c
+++ b/arch/arm/mach-shmobile/board-bockw.c
@@ -34,6 +34,8 @@
 #include <linux/mmc/sh_mobile_sdhi.h>
 #include <linux/usb/ehci_pdriver.h>
 #include <linux/usb/ohci_pdriver.h>
+#include <linux/spi/spi.h>
+#include <linux/spi/sh_hspi.h>
 #include <mach/irqs.h>
 #include <mach/common.h>
 #include <mach/r8a7778.h>
@@ -271,6 +273,21 @@ static struct platform_device ohci0_device = {
 	.resource	= ohci0_resources,
 };
 
+/* HSPI */
+static struct resource hspi_resources[] = {
+	[0] = {
+		.start		= 0xFFFC7000,
+		.end		= 0xFFFC7018 - 1,
+		.flags		= IORESOURCE_MEM,
+	},
+};
+
+static struct platform_device hspi_device = {
+	.name		= "sh-hspi",
+	.id		= 0,
+	.resource	= hspi_resources,
+	.num_resources	= ARRAY_SIZE(hspi_resources),
+};
 
 static struct platform_device *bockw_devices[] __initdata = {
 	&smsc911x_device,
@@ -280,6 +297,7 @@ static struct platform_device *bockw_devices[] __initdata = {
 	&sdhi0_device,
 	&ehci0_device,
 	&ohci0_device,
+	&hspi_device,
 };
 
 /* USBH common register */
@@ -428,6 +446,12 @@ static void __init bockw_init(void)
 	gpio_request(GPIO_FN_SD0_WP, NULL);
 	__raw_writel(__raw_readl(PUPR4) | (3 << 26), PUPR4);
 
+	/* HSPI 0 */
+	gpio_request(GPIO_FN_HSPI_CLK0_A, NULL);
+	gpio_request(GPIO_FN_HSPI_CS0_A,  NULL);
+	gpio_request(GPIO_FN_HSPI_TX0,  NULL);
+	gpio_request(GPIO_FN_HSPI_RX0_A,  NULL);
+
 	rcar_usb_phy_init();
 
 	i2c_register_board_info(0, i2c0_devices,
-- 
1.8.2

