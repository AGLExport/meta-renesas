From bbe48697ad3c96991d2c7c31d3b2b312cb305c8e Mon Sep 17 00:00:00 2001
From: Yusuke Goda <yusuke.goda.sx@renesas.com>
Date: Tue, 11 Jun 2013 20:00:44 +0900
Subject: [PATCH 592/611] ARM: shmobile: r8a7778: add MERAM support

Signed-off-by: Yusuke Goda <yusuke.goda.sx@renesas.com>
---
 arch/arm/mach-shmobile/board-bockw.c          |  8 ++++++++
 arch/arm/mach-shmobile/include/mach/r8a7778.h |  1 +
 arch/arm/mach-shmobile/setup-r8a7778.c        | 22 ++++++++++++++++++++++
 3 files changed, 31 insertions(+)

diff --git a/arch/arm/mach-shmobile/board-bockw.c b/arch/arm/mach-shmobile/board-bockw.c
index b846af0..d697130 100644
--- a/arch/arm/mach-shmobile/board-bockw.c
+++ b/arch/arm/mach-shmobile/board-bockw.c
@@ -187,6 +187,13 @@ static struct uio_info vpc_plat = {
 	.irq = -1,
 };
 
+/* MERAM */
+static struct uio_info meram_plat = {
+	.name = "MERAM",
+	.version = "0",
+	.irq = -1,
+};
+
 /* SSI/AK4554 */
 static struct rsnd_ssi_platform_info rsnd_ssi[] = {
 	RSND_SSI_UNUSED, /* SSI 0 */
@@ -484,6 +491,7 @@ static void __init bockw_init(void)
 	r8a7778_add_gp2d_device();
 	r8a7778_add_ipmmu_device(&ipmmu_plat);
 	r8a7778_add_vpc_device(&vpc_plat);
+	r8a7778_add_meram_device(&meram_plat);
 	platform_device_register_data(&platform_bus, "soc-camera-pdrv", 0,
 				      &iclink0_ml86v7667,
 				      sizeof(iclink0_ml86v7667));
diff --git a/arch/arm/mach-shmobile/include/mach/r8a7778.h b/arch/arm/mach-shmobile/include/mach/r8a7778.h
index 001bf1f..a81c987 100644
--- a/arch/arm/mach-shmobile/include/mach/r8a7778.h
+++ b/arch/arm/mach-shmobile/include/mach/r8a7778.h
@@ -43,6 +43,7 @@ extern void r8a7778_add_du_device(struct rcar_du_platform_data *info);
 extern void r8a7778_add_gp2d_device(void);
 extern void r8a7778_add_ipmmu_device(struct uio_info *info);
 extern void r8a7778_add_vpc_device(struct uio_info *info);
+extern void r8a7778_add_meram_device(struct uio_info *info);
 
 
 extern void r8a7778_init_late(void);
diff --git a/arch/arm/mach-shmobile/setup-r8a7778.c b/arch/arm/mach-shmobile/setup-r8a7778.c
index 9842237..9fc2891 100644
--- a/arch/arm/mach-shmobile/setup-r8a7778.c
+++ b/arch/arm/mach-shmobile/setup-r8a7778.c
@@ -469,6 +469,28 @@ void __init r8a7778_add_vpc_device(struct uio_info *info)
 	platform_device_register_full(&pdevinfo);
 }
 
+/* MERAM */
+static struct resource meram_resources[] __initdata = {
+	DEFINE_RES_MEM(0xfd200000, 0x418 + 0x020 * 32 -1),
+	DEFINE_RES_MEM(0xfd480000, ((512 - 32) << 10) - 1),
+
+};
+
+void __init r8a7778_add_meram_device(struct uio_info *info)
+{
+	struct platform_device_info pdevinfo = {
+		.parent		= &platform_bus,
+		.name		= "uio_pdrv_genirq",
+		.id		= 2,
+		.res		= meram_resources,
+		.num_res	= ARRAY_SIZE(meram_resources),
+		.data		= info,
+		.size_data	= sizeof(*info),
+	};
+
+	platform_device_register_full(&pdevinfo);
+}
+
 void __init r8a7778_add_standard_devices(void)
 {
 	int i;
-- 
1.8.2

