From 4b0d627cc7f061e3c94a3a26b9e8b51ce661819c Mon Sep 17 00:00:00 2001
From: Shunsuke Kataoka <shunsuke.kataoka.df@renesas.com>
Date: Wed, 31 Jul 2013 13:58:45 +0900
Subject: [PATCH 0813/1083] ARM: shmobile: r8a7791: Add scu_pcm driver support

Signed-off-by: Shunsuke Kataoka <shunsuke.kataoka.df@renesas.com>
---
 arch/arm/mach-shmobile/board-koelsch.c |  7 ++++++
 arch/arm/mach-shmobile/clock-r8a7791.c | 22 +++++++++++++++++-
 arch/arm/mach-shmobile/setup-r8a7791.c | 42 ++++++++++++++++++++++++++++++++++
 3 files changed, 70 insertions(+), 1 deletion(-)

diff --git a/arch/arm/mach-shmobile/board-koelsch.c b/arch/arm/mach-shmobile/board-koelsch.c
index c7b8531..ab43e98 100644
--- a/arch/arm/mach-shmobile/board-koelsch.c
+++ b/arch/arm/mach-shmobile/board-koelsch.c
@@ -42,6 +42,10 @@
 #include <asm/mach-types.h>
 #include <asm/mach/arch.h>
 
+static struct i2c_board_info koelsch_i2c_devices[] = {
+	{ I2C_BOARD_INFO("ak4642", 0x12), },
+};
+
 /* SPI Flash memory (Spansion S25FL512SAGMFIG11) */
 static struct mtd_partition spiflash_part[] = {
 	/* Reserved for user loader program, read-only */
@@ -369,6 +373,9 @@ static void __init koelsch_add_standard_devices(void)
 	platform_add_devices(koelsch_devices,
 			     ARRAY_SIZE(koelsch_devices));
 
+	i2c_register_board_info(2, koelsch_i2c_devices,
+				ARRAY_SIZE(koelsch_i2c_devices));
+
 	/* QSPI flash memory */
 	spi_register_board_info(spi_info, ARRAY_SIZE(spi_info));
 
diff --git a/arch/arm/mach-shmobile/clock-r8a7791.c b/arch/arm/mach-shmobile/clock-r8a7791.c
index 95daa48..1803fa9 100644
--- a/arch/arm/mach-shmobile/clock-r8a7791.c
+++ b/arch/arm/mach-shmobile/clock-r8a7791.c
@@ -181,7 +181,9 @@ enum {
 	MSTP704, MSTP703, MSTP328,
 	MSTP000, MSTP208, MSTP205,
 	MSTP917,
-	MSTP931, MSTP930, MSTP929, MSTP928, MSTP927, MSTP925,
+	MSTP931, MSTP930, MSTP929, MSTP928, MSTP927, MSTP925, MSTP922,
+	MSTP1031, MSTP1030, MSTP1019, MSTP1018, MSTP1017, MSTP1015, MSTP1014,
+	MSTP1005,
 	MSTP_NR
 };
 
@@ -228,6 +230,15 @@ static struct clk mstp_clks[MSTP_NR] = {
 	[MSTP928] = SH_CLK_MSTP32(&hp_clk, SMSTPCR9, 28, 0),
 	[MSTP927] = SH_CLK_MSTP32(&hp_clk, SMSTPCR9, 27, 0),
 	[MSTP925] = SH_CLK_MSTP32(&hp_clk, SMSTPCR9, 25, 0),
+	[MSTP922] = SH_CLK_MSTP32(&hp_clk, SMSTPCR9, 22, 0),
+	[MSTP1031] = SH_CLK_MSTP32(&hp_clk, SMSTPCR10, 31, 0),
+	[MSTP1030] = SH_CLK_MSTP32(&hp_clk, SMSTPCR10, 30, 0),
+	[MSTP1019] = SH_CLK_MSTP32(&hp_clk, SMSTPCR10, 19, 0),
+	[MSTP1018] = SH_CLK_MSTP32(&hp_clk, SMSTPCR10, 18, 0),
+	[MSTP1017] = SH_CLK_MSTP32(&hp_clk, SMSTPCR10, 17, 0),
+	[MSTP1015] = SH_CLK_MSTP32(&hp_clk, SMSTPCR10, 15, 0),
+	[MSTP1014] = SH_CLK_MSTP32(&hp_clk, SMSTPCR10, 14, 0),
+	[MSTP1005] = SH_CLK_MSTP32(&hp_clk, SMSTPCR10, 05, 0),
 };
 
 static struct clk_lookup lookups[] = {
@@ -295,6 +306,15 @@ static struct clk_lookup lookups[] = {
 	CLKDEV_DEV_ID("vin.0", &mstp_clks[MSTP811]),
 	CLKDEV_DEV_ID("vin.1", &mstp_clks[MSTP810]),
 	CLKDEV_DEV_ID("vin.2", &mstp_clks[MSTP809]),
+	CLKDEV_CON_ID("adg", &mstp_clks[MSTP922]),
+	CLKDEV_CON_ID("src0", &mstp_clks[MSTP1031]),
+	CLKDEV_CON_ID("src1", &mstp_clks[MSTP1030]),
+	CLKDEV_CON_ID("dvc0", &mstp_clks[MSTP1019]),
+	CLKDEV_CON_ID("dvc1", &mstp_clks[MSTP1018]),
+	CLKDEV_CON_ID("scu", &mstp_clks[MSTP1017]),
+	CLKDEV_CON_ID("ssi0", &mstp_clks[MSTP1015]),
+	CLKDEV_CON_ID("ssi1", &mstp_clks[MSTP1014]),
+	CLKDEV_CON_ID("ssi", &mstp_clks[MSTP1005]),
 };
 
 #define R8A7791_CLOCK_ROOT(e, m, p0, p1, p30, p31)		\
diff --git a/arch/arm/mach-shmobile/setup-r8a7791.c b/arch/arm/mach-shmobile/setup-r8a7791.c
index 2c100e4..79cc0c9 100644
--- a/arch/arm/mach-shmobile/setup-r8a7791.c
+++ b/arch/arm/mach-shmobile/setup-r8a7791.c
@@ -1134,6 +1134,46 @@ static struct platform_device sysdmau_device = {
 	},
 };
 
+/* Audio */
+static struct platform_device alsa_soc_platform_device = {
+	.name		= "koelsch_alsa_soc_platform",
+	.id		= 0,
+};
+
+static struct resource scu_resources[] = {
+	[0] = {
+		.name   = "scu",
+		.start  = 0xec000000,
+		.end    = 0xec500fff,
+		.flags  = IORESOURCE_MEM,
+	},
+	[1] = {
+		.name   = "ssiu",
+		.start  = 0xec540000,
+		.end    = 0xec54085f,
+		.flags  = IORESOURCE_MEM,
+	},
+	[2] = {
+		.name   = "ssi",
+		.start  = 0xec541000,
+		.end    = 0xec54127f,
+		.flags  = IORESOURCE_MEM,
+	},
+	[3] = {
+		.name   = "adg",
+		.start  = 0xec5a0000,
+		.end    = 0xec5a0067,
+		.flags  = IORESOURCE_MEM,
+	},
+};
+
+static struct platform_device scu_device = {
+	.name		= "scu-pcm-audio",
+	.id		= 0,
+	.num_resources	= ARRAY_SIZE(scu_resources),
+	.resource	= scu_resources,
+};
+
 /* QSPI */
 static struct resource qspi_resources[] = {
 	[0] = {
@@ -1445,6 +1485,8 @@ static struct platform_device *r8a7791_early_devices[] __initdata = {
 	&audmapp_device,
 	&sysdmal_device,
 	&sysdmau_device,
+	&alsa_soc_platform_device,
+	&scu_device,
 	&qspi_device,
 	&sh_msiof0_device,
 	&sh_msiof1_device,
-- 
1.8.3.2

