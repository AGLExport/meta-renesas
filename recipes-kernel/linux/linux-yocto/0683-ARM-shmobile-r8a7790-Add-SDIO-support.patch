From a0955de2d7f8e9816f7bf8117fd5546f9035b228 Mon Sep 17 00:00:00 2001
From: Yoshikazu Fujikawa <yoshikazu.fujikawa.ue@renesas.com>
Date: Thu, 27 Jun 2013 18:34:16 +0900
Subject: [PATCH 0683/1083] ARM: shmobile: r8a7790: Add SDIO support

Signed-off-by: Yoshikazu Fujikawa <yoshikazu.fujikawa.ue@renesas.com>
(cherry picked from commit 6ab96baeb8dfeb5c41c928684166652926ebaa2b)

Signed-off-by: Ryo Kataoka <ryo.kataoka.wt@renesas.com>
---
 arch/arm/mach-shmobile/setup-r8a7790.c | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/arch/arm/mach-shmobile/setup-r8a7790.c b/arch/arm/mach-shmobile/setup-r8a7790.c
index 33a5559..3affcaa 100644
--- a/arch/arm/mach-shmobile/setup-r8a7790.c
+++ b/arch/arm/mach-shmobile/setup-r8a7790.c
@@ -643,9 +643,10 @@ static struct resource sdhi0_resources[] = {
 static struct sh_mobile_sdhi_info sdhi0_platform_data = {
 	.dma_slave_tx	= SHDMA_SLAVE_SDHI0_TX,
 	.dma_slave_rx	= SHDMA_SLAVE_SDHI0_RX,
-	.tmio_caps = MMC_CAP_SD_HIGHSPEED,
+	.tmio_caps = MMC_CAP_SD_HIGHSPEED | MMC_CAP_SDIO_IRQ,
 	.tmio_caps2 = MMC_CAP2_NO_2BLKS_READ,
 	.tmio_flags	= (TMIO_MMC_WRPROTECT_DISABLE
+				| TMIO_MMC_SDIO_STATUS_QUIRK
 				| TMIO_MMC_HAS_IDLE_WAIT
 				| TMIO_MMC_BUFF_16BITACC_ACTIVE_HIGH
 				| TMIO_MMC_NO_CTL_RESET_SDIO
@@ -682,9 +683,10 @@ static struct resource sdhi1_resources[] = {
 static struct sh_mobile_sdhi_info sdhi1_platform_data = {
 	.dma_slave_tx	= SHDMA_SLAVE_SDHI1_TX,
 	.dma_slave_rx	= SHDMA_SLAVE_SDHI1_RX,
-	.tmio_caps = MMC_CAP_SD_HIGHSPEED,
+	.tmio_caps = MMC_CAP_SD_HIGHSPEED | MMC_CAP_SDIO_IRQ,
 	.tmio_caps2 = MMC_CAP2_NO_2BLKS_READ,
 	.tmio_flags	= (TMIO_MMC_WRPROTECT_DISABLE
+				| TMIO_MMC_SDIO_STATUS_QUIRK
 				| TMIO_MMC_HAS_IDLE_WAIT
 				| TMIO_MMC_BUFF_16BITACC_ACTIVE_HIGH
 				| TMIO_MMC_NO_CTL_RESET_SDIO
@@ -721,9 +723,10 @@ static struct resource sdhi2_resources[] = {
 static struct sh_mobile_sdhi_info sdhi2_platform_data = {
 	.dma_slave_tx	= SHDMA_SLAVE_SDHI2_TX,
 	.dma_slave_rx	= SHDMA_SLAVE_SDHI2_RX,
-	.tmio_caps = MMC_CAP_SD_HIGHSPEED,
+	.tmio_caps = MMC_CAP_SD_HIGHSPEED | MMC_CAP_SDIO_IRQ,
 	.tmio_caps2 = MMC_CAP2_NO_2BLKS_READ,
 	.tmio_flags	= (TMIO_MMC_WRPROTECT_DISABLE
+				| TMIO_MMC_SDIO_STATUS_QUIRK
 				| TMIO_MMC_HAS_IDLE_WAIT
 				| TMIO_MMC_NO_CTL_RESET_SDIO
 				| TMIO_MMC_NO_CTL_CLK_AND_WAIT_CTL
@@ -760,9 +763,10 @@ static struct resource sdhi3_resources[] = {
 static struct sh_mobile_sdhi_info sdhi3_platform_data = {
 	.dma_slave_tx	= SHDMA_SLAVE_SDHI3_TX,
 	.dma_slave_rx	= SHDMA_SLAVE_SDHI3_RX,
-	.tmio_caps = MMC_CAP_SD_HIGHSPEED,
+	.tmio_caps = MMC_CAP_SD_HIGHSPEED | MMC_CAP_SDIO_IRQ,
 	.tmio_caps2 = MMC_CAP2_NO_2BLKS_READ,
 	.tmio_flags	= (TMIO_MMC_WRPROTECT_DISABLE
+				| TMIO_MMC_SDIO_STATUS_QUIRK
 				| TMIO_MMC_HAS_IDLE_WAIT
 				| TMIO_MMC_NO_CTL_RESET_SDIO
 				| TMIO_MMC_NO_CTL_CLK_AND_WAIT_CTL
-- 
1.8.3.2

