From ea2f9dfc5e4d20d0277156280a8e841a6e145282 Mon Sep 17 00:00:00 2001
From: Shinobu Uehara <shinobu.uehara.xc@renesas.com>
Date: Fri, 14 Jun 2013 11:57:45 +0900
Subject: [PATCH 508/715] mmc: sh_mobile_sdhi: Add buffer access size switch
 option

Signed-off-by: Shinobu Uehara <shinobu.uehara.xc@renesas.com>
(cherry picked from commit 43132bf458d235642ebb86932c1f07f0ce313d50)

Signed-off-by: Ryo Kataoka <ryo.kataoka.wt@renesas.com>
---
 drivers/mmc/host/sh_mobile_sdhi.c |    5 +++++
 include/linux/mfd/tmio.h          |    3 +++
 2 files changed, 8 insertions(+)

diff --git a/drivers/mmc/host/sh_mobile_sdhi.c b/drivers/mmc/host/sh_mobile_sdhi.c
index 0bdc146..335933a 100644
--- a/drivers/mmc/host/sh_mobile_sdhi.c
+++ b/drivers/mmc/host/sh_mobile_sdhi.c
@@ -1,6 +1,7 @@
 /*
  * SuperH Mobile SDHI
  *
+ * Copyright (C) 2013 Renesas Electronics Corporation
  * Copyright (C) 2009 Magnus Damm
  *
  * This program is free software; you can redistribute it and/or modify
@@ -193,6 +194,10 @@ static int __devinit sh_mobile_sdhi_probe(struct platform_device *pdev)
 	if (ret < 0)
 		goto eprobe;
 
+	/* Set 16bit access */
+	if (mmc_data->flags & TMIO_MMC_BUFF_16BITACC_ACTIVE_HIGH)
+		sd_ctrl_write16(host, 0xe4, 1);
+
 	/*
 	 * Allow one or more specific (named) ISRs or
 	 * one or more multiplexed (un-named) ISRs.
diff --git a/include/linux/mfd/tmio.h b/include/linux/mfd/tmio.h
index d83af39..9d35929 100644
--- a/include/linux/mfd/tmio.h
+++ b/include/linux/mfd/tmio.h
@@ -82,6 +82,9 @@
  */
 #define TMIO_MMC_USE_GPIO_CD		(1 << 5)
 
+/* Switch the register of controller to access the buffer of 16 bit. */
+#define TMIO_MMC_BUFF_16BITACC_ACTIVE_HIGH	(1 << 6)
+
 int tmio_core_mmc_enable(void __iomem *cnf, int shift, unsigned long base);
 int tmio_core_mmc_resume(void __iomem *cnf, int shift, unsigned long base);
 void tmio_core_mmc_pwr(void __iomem *cnf, int shift, int state);
-- 
1.7.10.4

