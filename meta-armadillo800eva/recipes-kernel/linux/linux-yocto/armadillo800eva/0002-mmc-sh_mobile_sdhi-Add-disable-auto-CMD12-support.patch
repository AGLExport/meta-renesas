From 66632dca0f8eb61130725b176e1052aea1573146 Mon Sep 17 00:00:00 2001
From: Shinobu Uehara <shinobu.uehara.xc@renesas.com>
Date: Tue, 6 Aug 2013 17:21:30 +0900
Subject: [PATCH 2/2] mmc: sh_mobile_sdhi: Add disable auto CMD12 support

Signed-off-by: Shinobu Uehara <shinobu.uehara.xc@renesas.com>
---
 drivers/mmc/host/sh_mobile_sdhi.c |    8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/mmc/host/sh_mobile_sdhi.c b/drivers/mmc/host/sh_mobile_sdhi.c
index 0bdc146..d4fa5c8 100644
--- a/drivers/mmc/host/sh_mobile_sdhi.c
+++ b/drivers/mmc/host/sh_mobile_sdhi.c
@@ -108,6 +108,13 @@ static int sh_mobile_sdhi_write16_hook(struct tmio_mmc_host *host, int addr)
 	return 0;
 }
 
+#define SH_MOBILE_SDHI_DISABLE_AUTO_CMD12	0x4000
+
+static void sh_mobile_sdhi_disable_auto_cmd12(int *val)
+{
+	*val |= SH_MOBILE_SDHI_DISABLE_AUTO_CMD12;
+}
+
 static void sh_mobile_sdhi_cd_wakeup(const struct platform_device *pdev)
 {
 	mmc_detect_change(dev_get_drvdata(&pdev->dev), msecs_to_jiffies(100));
@@ -155,6 +162,7 @@ static int __devinit sh_mobile_sdhi_probe(struct platform_device *pdev)
 	mmc_data->clk_enable = sh_mobile_sdhi_clk_enable;
 	mmc_data->clk_disable = sh_mobile_sdhi_clk_disable;
 	mmc_data->capabilities = MMC_CAP_MMC_HIGHSPEED;
+	mmc_data->disable_auto_cmd12 = sh_mobile_sdhi_disable_auto_cmd12;
 	if (p) {
 		mmc_data->flags = p->tmio_flags;
 		if (mmc_data->flags & TMIO_MMC_HAS_IDLE_WAIT)
-- 
1.7.9.5

